#!/usr/share/ucs-test/runner bash
# shellcheck shell=bash
## desc: "Check policies"
## exposure: dangerous
## packages:
## - univention-s4-connector
## roles:
## - domaincontroller_master
## - domaincontroller_backup
## bugs:
##  - 49838

# shellcheck source=../../lib/base.sh
. "$TESTLIBPATH/base.sh" || exit 137
# shellcheck source=../../lib/udm.sh
. "$TESTLIBPATH/udm.sh" || exit 137
# shellcheck source=../../lib/random.sh
. "$TESTLIBPATH/random.sh" || exit 137
. "s4connector.sh" || exit 137

RETVAL=100

test -n "$connector_s4_ldap_host" || exit 137
connector_running_on_this_host || exit 137
SYNCMODE="$(ad_get_sync_mode)"
ad_set_sync_mode "sync"

ucr set connector/s4/mapping/msgpwl?no

eval "$(ucr shell)"

ucr set connector/s4/mapping/msgpwl=yes

service univention-s4-connector restart

policy_name="{E1E20275-CBF3-46D4-B926-$(random_chars 12 "ABCDEF0123456789")}"
policy_base="CN=$policy_name,CN=Policies,CN=System,$samba4_ldap_base"
policy_base_ucs="CN=$policy_name,CN=Policies,CN=System,$ldap_base"

echo -e "
dn: CN=$policy_name,CN=Policies,CN=System,$samba4_ldap_base
objectClass: top
objectClass: container
objectClass: groupPolicyContainer
cn: $policy_name
displayName: Neues Gruppenrichtlinienobjekt
gPCFileSysPath: \\\\$domainname\\SysVol\\$domainname\\Policies\\$policy_name
gPCFunctionalityVersion: 2
flags: 0
gPCMachineExtensionNames: [{0ACDD40C-75AC-47AB-BAA0-BF6DE7E7FE63}{2DA6AA7F-8C88-4194-A558-0D36E7FD3E64}][{B587E2B1-4D59-4E7E-AED9-22B9DF11D053}{06993B16-A5C7-47EB-B61C-B1CB7EE600AC}][{C6DC5466-785A-11D2-84D0-00C04FB169F7}{942A8E4F-A261-11D1-A760-00C04FB9603F}]
versionNumber: 10

dn: CN=Machine,CN=$policy_name,CN=Policies,CN=System,$samba4_ldap_base
objectClass: top
objectClass: container
cn: Machine

dn: CN=Microsoft,CN=Machine,CN=$policy_name,CN=Policies,CN=System,$samba4_ldap_base
objectClass: top
objectClass: container
cn: Microsoft

dn: CN=Windows,CN=Microsoft,CN=Machine,CN=$policy_name,CN=Policies,CN=System,$samba4_ldap_base
objectClass: top
objectClass: container
cn: Windows

dn: CN=IEEE80211,CN=Windows,CN=Microsoft,CN=Machine,CN=$policy_name,CN=Policies,CN=System,$samba4_ldap_base
objectClass: top
objectClass: container
cn: IEEE80211

dn: CN=Neue Drahtlosnetzwerkrichtlinie,CN=IEEE80211,CN=Windows,CN=Microsoft,CN=Machine,CN=$policy_name,CN=Policies,CN=System,$samba4_ldap_base
objectClass: top
objectClass: ms-net-ieee-80211-GroupPolicy
cn: Neue Drahtlosnetzwerkrichtlinie
description: Beispielbeschreibung
ms-net-ieee-80211-GP-PolicyGUID: {70463c70-ba51-4f25-a711-0d7d2abf2c82}
ms-net-ieee-80211-GP-PolicyData:: PD94bWwgdmVyc2lvbj0iMS4wIj8+DQo8V0xBTlBvbGljeSB4bWxucz0iaHR0cDovL3d3dy5taWNyb3NvZnQuY29tL25ldHdvcmtpbmcvV0xBTi9wb2xpY3kvdjEiPg0KCTxuYW1lPk5ldWUgRHJhaHRsb3NuZXR6d2Vya3JpY2h0bGluaWU8L25hbWU+DQoJPGRlc2NyaXB0aW9uPkJlaXNwaWVsYmVzY2hyZWlidW5nPC9kZXNjcmlwdGlvbj4NCgk8Z2xvYmFsRmxhZ3M+DQoJCTxlbmFibGVBdXRvQ29uZmlnPnRydWU8L2VuYWJsZUF1dG9Db25maWc+DQoJCTxzaG93RGVuaWVkTmV0d29yaz50cnVlPC9zaG93RGVuaWVkTmV0d29yaz4NCgkJPGFsbG93RXZlcnlvbmVUb0NyZWF0ZUFsbFVzZXJQcm9maWxlcz50cnVlPC9hbGxvd0V2ZXJ5b25lVG9DcmVhdGVBbGxVc2VyUHJvZmlsZXM+DQoJCTxvbmx5VXNlR1BQcm9maWxlc0ZvckFsbG93ZWROZXR3b3JrcyB4bWxucz0iaHR0cDovL3d3dy5taWNyb3NvZnQuY29tL25ldHdvcmtpbmcvV0xBTi9wb2xpY3kvdjIiPmZhbHNlPC9vbmx5VXNlR1BQcm9maWxlc0ZvckFsbG93ZWROZXR3b3Jrcz4NCgkJPGVuYWJsZVNvZnRBUCB4bWxucz0iaHR0cDovL3d3dy5taWNyb3NvZnQuY29tL25ldHdvcmtpbmcvV0xBTi9wb2xpY3kvdjMiPnRydWU8L2VuYWJsZVNvZnRBUD4NCgk8L2dsb2JhbEZsYWdzPg0KCTxuZXR3b3JrRmlsdGVyPg0KCQk8YWxsb3dMaXN0Pg0KCQkJPG5ldHdvcms+DQoJCQkJPG5ldHdvcmtOYW1lPk5FV1NTSUQ8L25ldHdvcmtOYW1lPg0KCQkJCTxuZXR3b3JrVHlwZT5FU1M8L25ldHdvcmtUeXBlPg0KCQkJPC9uZXR3b3JrPg0KCQk8L2FsbG93TGlzdD4NCgkJPGJsb2NrTGlzdD4NCgkJCTxuZXR3b3JrPg0KCQkJCTxuZXR3b3JrTmFtZT5ORVdTU0lEKDIpPC9uZXR3b3JrTmFtZT4NCgkJCQk8bmV0d29ya1R5cGU+RVNTPC9uZXR3b3JrVHlwZT4NCgkJCTwvbmV0d29yaz4NCgkJPC9ibG9ja0xpc3Q+DQoJCTxkZW55QWxsSUJTUz5mYWxzZTwvZGVueUFsbElCU1M+DQoJCTxkZW55QWxsRVNTPmZhbHNlPC9kZW55QWxsRVNTPg0KCTwvbmV0d29ya0ZpbHRlcj4NCgk8cHJvZmlsZUxpc3Q+DQoJCTxXTEFOUHJvZmlsZSB4bWxucz0iaHR0cDovL3d3dy5taWNyb3NvZnQuY29tL25ldHdvcmtpbmcvV0xBTi9wcm9maWxlL3YxIj4NCgkJCTxuYW1lPk5ldWVzIFByb2ZpbDwvbmFtZT4NCgkJCTxTU0lEQ29uZmlnPg0KCQkJCTxTU0lEPg0KCQkJCQk8aGV4PjRFNDU1NzUzNTM0OTQ0PC9oZXg+DQoJCQkJCTxuYW1lPk5FV1NTSUQ8L25hbWU+DQoJCQkJPC9TU0lEPg0KCQkJCTxub25Ccm9hZGNhc3Q+ZmFsc2U8L25vbkJyb2FkY2FzdD4NCgkJCTwvU1NJRENvbmZpZz4NCgkJCTxjb25uZWN0aW9uVHlwZT5FU1M8L2Nvbm5lY3Rpb25UeXBlPg0KCQkJPGNvbm5lY3Rpb25Nb2RlPmF1dG88L2Nvbm5lY3Rpb25Nb2RlPg0KCQkJPGF1dG9Td2l0Y2g+dHJ1ZTwvYXV0b1N3aXRjaD4NCgkJCTxNU00+DQoJCQkJPHNlY3VyaXR5Pg0KCQkJCQk8YXV0aEVuY3J5cHRpb24+DQoJCQkJCQk8YXV0aGVudGljYXRpb24+V1BBMjwvYXV0aGVudGljYXRpb24+DQoJCQkJCQk8ZW5jcnlwdGlvbj5BRVM8L2VuY3J5cHRpb24+DQoJCQkJCQk8dXNlT25lWD50cnVlPC91c2VPbmVYPg0KCQkJCQk8L2F1dGhFbmNyeXB0aW9uPg0KCQkJCQk8UE1LQ2FjaGVNb2RlPmVuYWJsZWQ8L1BNS0NhY2hlTW9kZT4NCgkJCQkJPFBNS0NhY2hlVFRMPjcyMDwvUE1LQ2FjaGVUVEw+DQoJCQkJCTxQTUtDYWNoZVNpemU+MTI4PC9QTUtDYWNoZVNpemU+DQoJCQkJCTxwcmVBdXRoVGhyb3R0bGU+MzwvcHJlQXV0aFRocm90dGxlPg0KCQkJCQk8T25lWCB4bWxucz0iaHR0cDovL3d3dy5taWNyb3NvZnQuY29tL25ldHdvcmtpbmcvT25lWC92MSI+DQoJCQkJCQk8bWF4QXV0aEZhaWx1cmVzPjE8L21heEF1dGhGYWlsdXJlcz4NCgkJCQkJCTxhdXRoTW9kZT5tYWNoaW5lT3JVc2VyPC9hdXRoTW9kZT4NCgkJCQkJCTxFQVBDb25maWc+PEVhcEhvc3RDb25maWcgeG1sbnM9Imh0dHA6Ly93d3cubWljcm9zb2Z0LmNvbS9wcm92aXNpb25pbmcvRWFwSG9zdENvbmZpZyI+PEVhcE1ldGhvZD48VHlwZSB4bWxucz0iaHR0cDovL3d3dy5taWNyb3NvZnQuY29tL3Byb3Zpc2lvbmluZy9FYXBDb21tb24iPjI1PC9UeXBlPjxWZW5kb3JJZCB4bWxucz0iaHR0cDovL3d3dy5taWNyb3NvZnQuY29tL3Byb3Zpc2lvbmluZy9FYXBDb21tb24iPjA8L1ZlbmRvcklkPjxWZW5kb3JUeXBlIHhtbG5zPSJodHRwOi8vd3d3Lm1pY3Jvc29mdC5jb20vcHJvdmlzaW9uaW5nL0VhcENvbW1vbiI+MDwvVmVuZG9yVHlwZT48QXV0aG9ySWQgeG1sbnM9Imh0dHA6Ly93d3cubWljcm9zb2Z0LmNvbS9wcm92aXNpb25pbmcvRWFwQ29tbW9uIj4wPC9BdXRob3JJZD48L0VhcE1ldGhvZD48Q29uZmlnIHhtbG5zPSJodHRwOi8vd3d3Lm1pY3Jvc29mdC5jb20vcHJvdmlzaW9uaW5nL0VhcEhvc3RDb25maWciPjxFYXAgeG1sbnM9Imh0dHA6Ly93d3cubWljcm9zb2Z0LmNvbS9wcm92aXNpb25pbmcvQmFzZUVhcENvbm5lY3Rpb25Qcm9wZXJ0aWVzVjEiPjxUeXBlPjI1PC9UeXBlPjxFYXBUeXBlIHhtbG5zPSJodHRwOi8vd3d3Lm1pY3Jvc29mdC5jb20vcHJvdmlzaW9uaW5nL01zUGVhcENvbm5lY3Rpb25Qcm9wZXJ0aWVzVjEiPjxTZXJ2ZXJWYWxpZGF0aW9uPjxEaXNhYmxlVXNlclByb21wdEZvclNlcnZlclZhbGlkYXRpb24+ZmFsc2U8L0Rpc2FibGVVc2VyUHJvbXB0Rm9yU2VydmVyVmFsaWRhdGlvbj48U2VydmVyTmFtZXM+PC9TZXJ2ZXJOYW1lcz48L1NlcnZlclZhbGlkYXRpb24+PEZhc3RSZWNvbm5lY3Q+dHJ1ZTwvRmFzdFJlY29ubmVjdD48SW5uZXJFYXBPcHRpb25hbD5mYWxzZTwvSW5uZXJFYXBPcHRpb25hbD48RWFwIHhtbG5zPSJodHRwOi8vd3d3Lm1pY3Jvc29mdC5jb20vcHJvdmlzaW9uaW5nL0Jhc2VFYXBDb25uZWN0aW9uUHJvcGVydGllc1YxIj48VHlwZT4yNjwvVHlwZT48RWFwVHlwZSB4bWxucz0iaHR0cDovL3d3dy5taWNyb3NvZnQuY29tL3Byb3Zpc2lvbmluZy9Nc0NoYXBWMkNvbm5lY3Rpb25Qcm9wZXJ0aWVzVjEiPjxVc2VXaW5Mb2dvbkNyZWRlbnRpYWxzPnRydWU8L1VzZVdpbkxvZ29uQ3JlZGVudGlhbHM+PC9FYXBUeXBlPjwvRWFwPjxFbmFibGVRdWFyYW50aW5lQ2hlY2tzPmZhbHNlPC9FbmFibGVRdWFyYW50aW5lQ2hlY2tzPjxSZXF1aXJlQ3J5cHRvQmluZGluZz5mYWxzZTwvUmVxdWlyZUNyeXB0b0JpbmRpbmc+PFBlYXBFeHRlbnNpb25zPjxQZXJmb3JtU2VydmVyVmFsaWRhdGlvbiB4bWxucz0iaHR0cDovL3d3dy5taWNyb3NvZnQuY29tL3Byb3Zpc2lvbmluZy9Nc1BlYXBDb25uZWN0aW9uUHJvcGVydGllc1YyIj50cnVlPC9QZXJmb3JtU2VydmVyVmFsaWRhdGlvbj48QWNjZXB0U2VydmVyTmFtZSB4bWxucz0iaHR0cDovL3d3dy5taWNyb3NvZnQuY29tL3Byb3Zpc2lvbmluZy9Nc1BlYXBDb25uZWN0aW9uUHJvcGVydGllc1YyIj5mYWxzZTwvQWNjZXB0U2VydmVyTmFtZT48L1BlYXBFeHRlbnNpb25zPjwvRWFwVHlwZT48L0VhcD48L0NvbmZpZz48L0VhcEhvc3RDb25maWc+PC9FQVBDb25maWc+DQoJCQkJCTwvT25lWD4NCgkJCQk8L3NlY3VyaXR5Pg0KCQkJPC9NU00+DQoJCTwvV0xBTlByb2ZpbGU+DQoJPC9wcm9maWxlTGlzdD4NCjwvV0xBTlBvbGljeT4NCg==

dn: CN=IEEE8023,CN=Windows,CN=Microsoft,CN=Machine,CN=$policy_name,CN=Policies,CN=System,$samba4_ldap_base
objectClass: top
objectClass: container
cn: IEEE8023

dn: CN=Neue Richtlinie f√ºr Kabelnetzwerke,CN=IEEE8023,CN=Windows,CN=Microsoft,CN=Machine,CN=$policy_name,CN=Policies,CN=System,$samba4_ldap_base
objectClass: top
objectClass: ms-net-ieee-8023-GroupPolicy
cn:: TmV1ZSBSaWNodGxpbmllIGbDvHIgS2FiZWxuZXR6d2Vya2U=
description: Beispielbeschreibung
ms-net-ieee-8023-GP-PolicyGUID: {8705b171-9380-4e17-b553-86f3edb7cadb}
ms-net-ieee-8023-GP-PolicyData:: PD94bWwgdmVyc2lvbj0iMS4wIj8+DQo8TEFOUG9saWN5IHhtbG5zPSJodHRwOi8vd3d3Lm1pY3Jvc29mdC5jb20vbmV0d29ya2luZy9MQU4vcG9saWN5L3YxIj4NCgk8bmFtZT5OZXVlIFJpY2h0bGluaWUgZsO8ciBLYWJlbG5ldHp3ZXJrZTwvbmFtZT4NCgk8ZGVzY3JpcHRpb24+QmVpc3BpZWxiZXNjaHJlaWJ1bmc8L2Rlc2NyaXB0aW9uPg0KCTxnbG9iYWxGbGFncz4NCgkJPGVuYWJsZUF1dG9Db25maWc+dHJ1ZTwvZW5hYmxlQXV0b0NvbmZpZz4NCgkJPGVuYWJsZUV4cGxpY2l0Q3JlZHMgeG1sbnM9Imh0dHA6Ly93d3cubWljcm9zb2Z0LmNvbS9uZXR3b3JraW5nL0xBTi9wb2xpY3kvdjIiPmZhbHNlPC9lbmFibGVFeHBsaWNpdENyZWRzPg0KCQk8YmxvY2tQZXJpb2QgeG1sbnM9Imh0dHA6Ly93d3cubWljcm9zb2Z0LmNvbS9uZXR3b3JraW5nL0xBTi9wb2xpY3kvdjIiPjIwPC9ibG9ja1BlcmlvZD4NCgk8L2dsb2JhbEZsYWdzPg0KCTxwcm9maWxlTGlzdD4NCgkJPExBTlByb2ZpbGUgeG1sbnM9Imh0dHA6Ly93d3cubWljcm9zb2Z0LmNvbS9uZXR3b3JraW5nL0xBTi9wcm9maWxlL3YxIj4NCgkJCTxNU00+DQoJCQkJPHNlY3VyaXR5Pg0KCQkJCQk8T25lWEVuZm9yY2VkPmZhbHNlPC9PbmVYRW5mb3JjZWQ+DQoJCQkJCTxPbmVYRW5hYmxlZD50cnVlPC9PbmVYRW5hYmxlZD4NCgkJCQkJPE9uZVggeG1sbnM9Imh0dHA6Ly93d3cubWljcm9zb2Z0LmNvbS9uZXR3b3JraW5nL09uZVgvdjEiPg0KCQkJCQkJPGNhY2hlVXNlckRhdGE+dHJ1ZTwvY2FjaGVVc2VyRGF0YT4NCgkJCQkJCTxoZWxkUGVyaW9kPjE8L2hlbGRQZXJpb2Q+DQoJCQkJCQk8YXV0aFBlcmlvZD4xODwvYXV0aFBlcmlvZD4NCgkJCQkJCTxzdGFydFBlcmlvZD41PC9zdGFydFBlcmlvZD4NCgkJCQkJCTxtYXhTdGFydD4zPC9tYXhTdGFydD4NCgkJCQkJCTxtYXhBdXRoRmFpbHVyZXM+MTwvbWF4QXV0aEZhaWx1cmVzPg0KCQkJCQkJPHN1cHBsaWNhbnRNb2RlPmNvbXBsaWFudDwvc3VwcGxpY2FudE1vZGU+DQoJCQkJCQk8YXV0aE1vZGU+bWFjaGluZU9yVXNlcjwvYXV0aE1vZGU+DQoJCQkJCQk8c2luZ2xlU2lnbk9uPg0KCQkJCQkJCTx0eXBlPnByZUxvZ29uPC90eXBlPg0KCQkJCQkJCTxtYXhEZWxheT4xMDwvbWF4RGVsYXk+DQoJCQkJCQkJPGFsbG93QWRkaXRpb25hbERpYWxvZ3M+dHJ1ZTwvYWxsb3dBZGRpdGlvbmFsRGlhbG9ncz4NCgkJCQkJCQk8dXNlckJhc2VkVmlydHVhbExhbj5mYWxzZTwvdXNlckJhc2VkVmlydHVhbExhbj4NCgkJCQkJCTwvc2luZ2xlU2lnbk9uPg0KCQkJCQkJPEVBUENvbmZpZz48RWFwSG9zdENvbmZpZyB4bWxucz0iaHR0cDovL3d3dy5taWNyb3NvZnQuY29tL3Byb3Zpc2lvbmluZy9FYXBIb3N0Q29uZmlnIj48RWFwTWV0aG9kPjxUeXBlIHhtbG5zPSJodHRwOi8vd3d3Lm1pY3Jvc29mdC5jb20vcHJvdmlzaW9uaW5nL0VhcENvbW1vbiI+MjU8L1R5cGU+PFZlbmRvcklkIHhtbG5zPSJodHRwOi8vd3d3Lm1pY3Jvc29mdC5jb20vcHJvdmlzaW9uaW5nL0VhcENvbW1vbiI+MDwvVmVuZG9ySWQ+PFZlbmRvclR5cGUgeG1sbnM9Imh0dHA6Ly93d3cubWljcm9zb2Z0LmNvbS9wcm92aXNpb25pbmcvRWFwQ29tbW9uIj4wPC9WZW5kb3JUeXBlPjxBdXRob3JJZCB4bWxucz0iaHR0cDovL3d3dy5taWNyb3NvZnQuY29tL3Byb3Zpc2lvbmluZy9FYXBDb21tb24iPjA8L0F1dGhvcklkPjwvRWFwTWV0aG9kPjxDb25maWcgeG1sbnM9Imh0dHA6Ly93d3cubWljcm9zb2Z0LmNvbS9wcm92aXNpb25pbmcvRWFwSG9zdENvbmZpZyI+PEVhcCB4bWxucz0iaHR0cDovL3d3dy5taWNyb3NvZnQuY29tL3Byb3Zpc2lvbmluZy9CYXNlRWFwQ29ubmVjdGlvblByb3BlcnRpZXNWMSI+PFR5cGU+MjU8L1R5cGU+PEVhcFR5cGUgeG1sbnM9Imh0dHA6Ly93d3cubWljcm9zb2Z0LmNvbS9wcm92aXNpb25pbmcvTXNQZWFwQ29ubmVjdGlvblByb3BlcnRpZXNWMSI+PFNlcnZlclZhbGlkYXRpb24+PERpc2FibGVVc2VyUHJvbXB0Rm9yU2VydmVyVmFsaWRhdGlvbj5mYWxzZTwvRGlzYWJsZVVzZXJQcm9tcHRGb3JTZXJ2ZXJWYWxpZGF0aW9uPjxTZXJ2ZXJOYW1lcz48L1NlcnZlck5hbWVzPjwvU2VydmVyVmFsaWRhdGlvbj48RmFzdFJlY29ubmVjdD50cnVlPC9GYXN0UmVjb25uZWN0PjxJbm5lckVhcE9wdGlvbmFsPmZhbHNlPC9Jbm5lckVhcE9wdGlvbmFsPjxFYXAgeG1sbnM9Imh0dHA6Ly93d3cubWljcm9zb2Z0LmNvbS9wcm92aXNpb25pbmcvQmFzZUVhcENvbm5lY3Rpb25Qcm9wZXJ0aWVzVjEiPjxUeXBlPjI2PC9UeXBlPjxFYXBUeXBlIHhtbG5zPSJodHRwOi8vd3d3Lm1pY3Jvc29mdC5jb20vcHJvdmlzaW9uaW5nL01zQ2hhcFYyQ29ubmVjdGlvblByb3BlcnRpZXNWMSI+PFVzZVdpbkxvZ29uQ3JlZGVudGlhbHM+dHJ1ZTwvVXNlV2luTG9nb25DcmVkZW50aWFscz48L0VhcFR5cGU+PC9FYXA+PEVuYWJsZVF1YXJhbnRpbmVDaGVja3M+ZmFsc2U8L0VuYWJsZVF1YXJhbnRpbmVDaGVja3M+PFJlcXVpcmVDcnlwdG9CaW5kaW5nPmZhbHNlPC9SZXF1aXJlQ3J5cHRvQmluZGluZz48UGVhcEV4dGVuc2lvbnM+PFBlcmZvcm1TZXJ2ZXJWYWxpZGF0aW9uIHhtbG5zPSJodHRwOi8vd3d3Lm1pY3Jvc29mdC5jb20vcHJvdmlzaW9uaW5nL01zUGVhcENvbm5lY3Rpb25Qcm9wZXJ0aWVzVjIiPnRydWU8L1BlcmZvcm1TZXJ2ZXJWYWxpZGF0aW9uPjxBY2NlcHRTZXJ2ZXJOYW1lIHhtbG5zPSJodHRwOi8vd3d3Lm1pY3Jvc29mdC5jb20vcHJvdmlzaW9uaW5nL01zUGVhcENvbm5lY3Rpb25Qcm9wZXJ0aWVzVjIiPmZhbHNlPC9BY2NlcHRTZXJ2ZXJOYW1lPjwvUGVhcEV4dGVuc2lvbnM+PC9FYXBUeXBlPjwvRWFwPjwvQ29uZmlnPjwvRWFwSG9zdENvbmZpZz48L0VBUENvbmZpZz4NCgkJCQkJPC9PbmVYPg0KCQkJCTwvc2VjdXJpdHk+DQoJCQk8L01TTT4NCgkJPC9MQU5Qcm9maWxlPg0KCTwvcHJvZmlsZUxpc3Q+DQo8L0xBTlBvbGljeT4NCg==

dn: CN=Wireless,CN=Windows,CN=Microsoft,CN=Machine,CN=$policy_name,CN=Policies,CN=System,$samba4_ldap_base
objectClass: top
objectClass: container
cn: Wireless

dn: CN=Neue XP-Drahtlosnetzwerkrichtlinie,CN=Wireless,CN=Windows,CN=Microsoft,CN=Machine,CN=$policy_name,CN=Policies,CN=System,$samba4_ldap_base
objectClass: top
objectClass: msieee80211-Policy
cn: Neue XP-Drahtlosnetzwerkrichtlinie
description: Beispielbeschreibung
msieee80211-DataType: 256
msieee80211-ID: {2d403346-3931-4ebe-aea4-014fedf15b69}
msieee80211-Data:: AwAAAPgAAAAwKgAAAAAAAAEAAAABAAAAAQAAAOQAAABOAEUAVwBTAFMASQBEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAABwAAAAMAAAAAAAAABQAAAAEAAAACAAAAAQAAAAIAAAAZAAAAAAAAAAEAAAABAAAAAAAAAAMAAAAFAAAAEgAAAAEAAAAUAAAAQgBlAGkAcwBwAGkAZQBsAGIAZQBzAGMAaAByAGUAaQBiAHUAbgBnAAAAAAABAAAAAAAAAAEAAAADAAAAAQAAAAEAAAABAAAAAgAAAIAAAADAqAAAAAAAAAIAAAAUAAAAMCoAAAAAAAABAAAAAQAAAAAAAAABAAAAFAAAADAqAAAAAAAAAQAAAAEAAAAAAAAA

" | ldbadd --verbose -H /var/lib/samba/private/sam.ldb || fail_test 110

ad_wait_for_synchronization; fail_bool 0 110

univention-ldapsearch -b "$policy_base_ucs" -s base dn -LLL  || fail_test 110
univention-ldapsearch -b "CN=Neue Drahtlosnetzwerkrichtlinie,  CN=IEEE80211,CN=Windows,CN=Microsoft,CN=Machine,$policy_base_ucs" -s base dn -LLL || fail_test 110
univention-ldapsearch -b "CN=Neue Richtlinie f√ºr Kabelnetzwerke,CN=IEEE8023,CN=Windows,CN=Microsoft,CN=Machine,$policy_base_ucs" -s base dn -LLL || fail_test 110
univention-ldapsearch -b "CN=Neue XP-Drahtlosnetzwerkrichtlinie,CN=Wireless,CN=Windows,CN=Microsoft,CN=Machine,$policy_base_ucs" -s base dn -LLL || fail_test 110

ldbdel -H /var/lib/samba/private/sam.ldb "CN=Neue XP-Drahtlosnetzwerkrichtlinie,CN=Wireless,CN=Windows,CN=Microsoft,CN=Machine,$policy_base" || fail_test 110
ldbdel -H /var/lib/samba/private/sam.ldb "CN=Neue Richtlinie f√ºr Kabelnetzwerke,CN=IEEE8023,CN=Windows,CN=Microsoft,CN=Machine,$policy_base" || fail_test 110
ldbdel -H /var/lib/samba/private/sam.ldb "CN=Neue Drahtlosnetzwerkrichtlinie,CN=IEEE80211,CN=Windows,CN=Microsoft,CN=Machine,$policy_base" || fail_test 110

ad_wait_for_synchronization; fail_bool 0 110

univention-ldapsearch -b "CN=Neue Drahtlosnetzwerkrichtlinie,CN=IEEE80211,CN=Windows,CN=Microsoft,CN=Machine,$policy_base_ucs" -s base dn -LLL && fail_test 110
univention-ldapsearch -b "CN=Neue Richtlinie f√ºr Kabelnetzwerke,CN=IEEE8023,CN=Windows,CN=Microsoft,CN=Machine,$policy_base_ucs" -s base dn -LLL && fail_test 110
univention-ldapsearch -b "CN=Neue XP-Drahtlosnetzwerkrichtlinie,CN=Wireless,CN=Windows,CN=Microsoft,CN=Machine,$policy_base_ucs" -s base dn -LLL && fail_test 110

ldbdel -H /var/lib/samba/private/sam.ldb -r "$policy_base" || fail_test 110
ad_wait_for_synchronization; fail_bool 0 110
univention-ldapsearch -b "$policy_base_ucs" -s base dn -LLL  && fail_test 110

ucr set connector/s4/mapping/msgpwl="$connector_s4_mapping_msgpwl"
ad_set_sync_mode "$SYNCMODE"

exit "$RETVAL"
